async function decrypt(e,t){const r=window.atob(e),o=r.length,n=new Uint8Array(o);for(let e=0;e<o;e++)n[e]=r.charCodeAt(e);const s=n.buffer,i=s.slice(0,32),c=s.slice(32,48),a=s.slice(48),d=new TextEncoder,y=await crypto.subtle.importKey("raw",d.encode(t),"PBKDF2",!1,["deriveKey"]),p=await crypto.subtle.deriveKey({name:"PBKDF2",salt:i,iterations:6e5,hash:"SHA-256"},y,{name:"AES-GCM",length:256},!0,["decrypt"]),l=new Uint8Array(await crypto.subtle.decrypt({name:"AES-GCM",iv:c},p,a));return(new TextDecoder).decode(l)}async function decryptLoginPage(e){let t=[];try{for(encrypted of encryptedContent){const r=await decrypt(encrypted,e);t.push(r)}for(element of document.getElementsByClassName("_siteCrypt-protected"))element.innerHTML=t.shift()}catch(e){console.log(e),showError("Incorrect password")}}async function doSubmit(e){hideError(),e.preventDefault(),decryptLoginPage(document.getElementById("_siteCrypt-password").value)}function hideError(){document.getElementById("_siteCrypt-passwordError").style.display="none"}function showError(e){let t=document.getElementById("_siteCrypt-passwordError");t.style.display="",t.textContent=e}function setupLoginPage(){document.getElementById("_siteCrypt-passwordForm")?isSecureContext?crypto.subtle?document.getElementById("_siteCrypt-passwordForm").addEventListener("submit",doSubmit):showError("This browser does not support the Web Crypto API"):showError("This page must be served over HTTPS to use SiteCrypt"):alert("Password form not found!  Please ensure the page is set up correctly.")}async function setupSubPage(e){if(window.location.hash.startsWith("#key="))try{let e=window.location.hash.substring(5);const t=await decrypt(encryptedContent,e);return void document.write(t)}catch(e){console.log("Password was incorrect, redirecting to login page")}window.location.href=e+"#from="+window.location.pathname}
