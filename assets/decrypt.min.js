let SiteCrypt={allEncryptedContentBase64:[],decrypt:async function decrypt(t,e){const r=window.atob(t),o=r.length,s=new Uint8Array(o);for(let t=0;t<o;t++)s[t]=r.charCodeAt(t);const n=s.buffer,i=n.slice(0,32),a=n.slice(32,48),d=n.slice(48),c=new TextEncoder,p=await crypto.subtle.importKey("raw",c.encode(e),"PBKDF2",!1,["deriveKey"]),y=await crypto.subtle.deriveKey({name:"PBKDF2",salt:i,iterations:6e5,hash:"SHA-256"},p,{name:"AES-GCM",length:256},!0,["decrypt"]),l=new Uint8Array(await crypto.subtle.decrypt({name:"AES-GCM",iv:a},y,d));return(new TextDecoder).decode(l)},decryptLoginPage:async function decryptLoginPage(t){let e=[];try{for(encrypted of SiteCrypt.allEncryptedContentBase64){const r=await SiteCrypt.decrypt(encrypted,t);e.push(r)}for(element of document.getElementsByClassName("_siteCrypt-protected"))element.innerHTML=e.shift();SiteCrypt.storePassword(t)}catch(t){console.log(t),SiteCrypt.showError("Incorrect password")}},doSubmit:async function doSubmit(t){SiteCrypt.hideError(),t.preventDefault(),SiteCrypt.decryptLoginPage(document.getElementById("_siteCrypt-password").value)},hideError:function hideError(){document.getElementById("_siteCrypt-passwordError").style.display="none"},showError:function showError(t){let e=document.getElementById("_siteCrypt-passwordError");e.style.display="",e.textContent=t},setupLoginPage:function setupLoginPage(){let t=document.getElementById("_siteCrypt-passwordForm");if(!t)return void alert("Password form not found!  Please ensure the page is set up correctly.");if(!isSecureContext)return void showError("This page must be served over HTTPS to use SiteCrypt");if(!crypto.subtle)return void SiteCrypt.showError("This browser does not support the Web Crypto API");let e=null;e=window.location.hash.startsWith("#pw=")?window.location.hash.substring(4):SiteCrypt.getStoredPassword(),t.addEventListener("submit",SiteCrypt.doSubmit),e&&(document.getElementById("_siteCrypt-password").value=e,t.requestSubmit())},setupSubPage:async function setupSubPage(t){let e=SiteCrypt.getStoredPassword();if(e)try{const t=await SiteCrypt.decrypt(SiteCrypt.allEncryptedContentBase64,e);return document.write(t),void SiteCrypt.storePassword(e)}catch(t){console.log("Password was incorrect, redirecting to login page")}window.location.href=t+"#from="+window.location.pathname},storePassword:function storePassword(t){sessionStorage.setItem("_siteCrypt-password",t)},getStoredPassword:function getStoredPassword(){let t=null;return t=window.location.hash.startsWith("#pw=")?window.location.hash.substring(4):sessionStorage.getItem("_siteCrypt-password"),t},logout:function logout(){sessionStorage.removeItem("_siteCrypt-password"),window.location.hash.startsWith("#pw=")&&(window.location.hash=""),window.location.reload()}};
